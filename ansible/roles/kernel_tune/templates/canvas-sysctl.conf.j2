# roles/kernel_tune/templates/canvas-sysctl.conf.j2
# Ansible-managed: canvas-bench kernel tuning — do not edit by hand

# ── File Descriptors ──
fs.file-max = 4194304
fs.nr_open  = 4194304

# ── Socket / UDP Buffers ──
net.core.rmem_max            = {{ rmem_max | default(67108864) }}
net.core.wmem_max            = {{ wmem_max | default(67108864) }}
net.core.rmem_default        = {{ rmem_default | default(33554432) }}
net.core.wmem_default        = {{ wmem_default | default(33554432) }}
net.ipv4.udp_rmem_min        = 65536
net.ipv4.udp_wmem_min        = 65536
net.ipv4.udp_mem             = 8388608 16777216 33554432
net.core.netdev_max_backlog  = 300000
net.core.somaxconn           = 65535
net.core.optmem_max          = 2048000
net.ipv4.ip_local_port_range = 1024 65535
vm.max_map_count             = 16777216

# ── Conntrack ──
# nf_conntrack_max: safety net only. All QUIC bench traffic is NOTRACK'd and
# never enters the conntrack table, so bucket count and UDP timeouts have no
# effect on benchmark performance. Only max matters to prevent non-bench traffic
# (SSH, etc.) from exhausting the table.
net.netfilter.nf_conntrack_max = 2097152

# ── Misc ──
kernel.randomize_va_space = 0
